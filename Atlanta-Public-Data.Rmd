---
title: "Atlanta Public Data"
knit: (function(input_file, encoding) {
  out_dir <- 'docs';
  rmarkdown::render(input_file,
 encoding=encoding,
 output_file=file.path(dirname(input_file), out_dir, 'index.html'))})
output:
  html_document:
    df_print: paged
    theme: darkly
    toc: true
    toc_float: true
    code_folding: hide
---

```{=html}
<style type="text/css">
.main-container {
  max-width: 1800px;
  margin-left: auto;
  margin-right: auto;
}
</style>
```

```{r}
library("htmltools")
library("here")
library("dplyr")
library("RSocrata")
library("tidyverse")
library(openxlsx) 
library(googledrive) 
```

# [Vendor Payments](https://data.fultoncountyga.gov/Tax-Finance/Vendor-Payments/mxhc-krcg)

This dataset consists of a listing of payments made to Fulton County vendors for poducts and services provided to the County. The payment records span the period from January 1, 2014 to present. Included with each payment record is the disbursement date, the department making the payment, the type of service or product, the fund from which the payment is drawn, the payment amount and the name of the vendor to which the payment was made. This dataset is updated weekly.

```{r download-vendor-payments, cache=TRUE, cache.extra = Sys.Date()}
## Install the required package with:
## install.packages("RSocrata")
library("dplyr")
library("RSocrata")
library("tidyverse")

VendorPayments <- read.socrata(
  "https://data.fultoncountyga.gov/resource/mxhc-krcg.json"
)
```

```{r}
VendorPayments
```

```{r}
VendorPayments <-
        VendorPayments %>% mutate(payment_type = as.factor(payment_type),
                                  city = as.factor(city),
                                  fiscal_year = as.numeric(fiscal_year),
                                  fy_period = as.numeric(fy_period),
                                  dept = as.factor(dept),
                                  unit = as.factor(unit),
                                  unit_name = as.factor(unit_name),
                                  object = as.factor(object),
                                  object_name = as.factor(object_name),
                                  fund = as.factor(fund),
                                  fund_name = as.factor(fund_name),
                                  amount = as.numeric(amount),
                                  # = as.numeric(),
                                  # = as.numeric(),
                                  # = as.numeric(),
                                  vendor_legal_name  = as.factor(vendor_legal_name),
                                  check_status  = as.factor(check_status),
                                  #  = as.factor(),
                                  #  = as.factor(),
                                  #  = as.factor(),
                                  department_name = as.factor(department_name)) %>%
        select(-c("vendor_code", "check_no","dis_doc_id", "payment_document", "vendor_invoice_no", "dept", "unit", "fiscal_year", "fy_period", "object", "fund", "vendor_invoice_date", "payment_type", "disb_week", "vendor_invoice_week", "check_clearance_or_cancel_date", "check_cc_week",	"city"
))
summary(VendorPayments, maxsum = 8)
```

# Upload Data to Goodle Drive

```{r upload-VendorPayments-Data, cache=TRUE, cache.extra = Sys.Date()} 

#googledrive::drive_auth() 
openxlsx::write.xlsx(list("Vendor Payments" = VendorPayments) , here("data/Atlanta.xlsx"), overwrite = TRUE, asTable = TRUE, freezePane = c("firstRow"), colWidths = "auto", withFilter = TRUE) 
#googledrive::drive_upload(media ="Atlanta.xlsx",   type = "spreadsheet", overwrite = TRUE) 
googledrive::drive_update(media =here("data/Atlanta.xlsx"), file = as_id("1yVUKyYIfw6-2f6HfHImNtVORrBTnuIuCpZRDrNCYaI8"))
```


# Present Data in Tablea

```{r}
includeHTML(path = here("docs/tableau-dashboard.html")) 
```
